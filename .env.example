# =======================================
# National Health Record System - Environment Configuration
# Email-Based Authentication Edition (ZERO COST)
# =======================================

# Application Environment
NODE_ENV=development
PORT=3000

# =======================================
# MongoDB Configuration
# =======================================
# Local: mongodb://localhost:27017/national-health-record-system
# Atlas FREE tier: mongodb+srv://username:password@cluster.mongodb.net/dbname
DATABASE_URL=mongodb://localhost:27017/national-health-record-system

# =======================================
# JWT Configuration
# =======================================
# Generate strong secrets: node -e "console.log(require('crypto').randomBytes(32).toString('hex'))"
JWT_SECRET=CHANGE_THIS_TO_A_STRONG_SECRET_MINIMUM_32_CHARACTERS
JWT_ACCESS_EXPIRY=15m
JWT_REFRESH_SECRET=CHANGE_THIS_TO_A_DIFFERENT_STRONG_SECRET_MINIMUM_32_CHARACTERS
JWT_REFRESH_EXPIRY=7d

# =======================================
# Email/SMTP Configuration (Gmail App Password - FREE)
# =======================================
# SETUP INSTRUCTIONS FOR FREE GMAIL SMTP:
# 1. Create Gmail account (e.g., healthsystem.noreply@gmail.com)
# 2. Enable 2-Factor Authentication: https://myaccount.google.com/security
# 3. Generate App Password: https://myaccount.google.com/apppasswords
# 4. Select "Mail" and "Other (Custom name)"
# 5. Copy the 16-character password and paste below
# 
# COST: â‚¹0 (Unlimited emails via Gmail)
SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
SMTP_SECURE=false
SMTP_USER=your-gmail@gmail.com
SMTP_PASSWORD=your-16-char-app-password-here
EMAIL_FROM=National Health System <your-gmail@gmail.com>
FRONTEND_URL=http://localhost:3000

# =======================================
# CORS Configuration
# =======================================
# - SendGrid: smtp.sendgrid.net:587 (API key as password)
# - Mailgun: smtp.mailgun.org:587
# - AWS SES: email-smtp.region.amazonaws.com:587
ALLOWED_ORIGINS=http://localhost:3000,http://localhost:4200

# =======================================
# Redis Configuration (for caching and queues)
# =======================================
# Local: redis://localhost:6379
# Redis Cloud FREE tier: redis://username:password@host:port
# If not set, will fall back to in-memory caching
# Format: redis://[username][:password]@host:port/database
# Example: redis://localhost:6379 or redis://user:pass@redis-host:6379/0
REDIS_URL=redis://localhost:6379

# BullMQ Queue Configuration
# Redis connection for job queues (can reuse REDIS_URL from caching or use separate)
# Using DB 1 for queues to separate from cache (DB 0)
QUEUE_REDIS_URL=redis://localhost:6379/1

# Alternative: Separate host/port configuration
# QUEUE_REDIS_HOST=localhost
# QUEUE_REDIS_PORT=6379
# QUEUE_REDIS_PASSWORD=
# QUEUE_REDIS_DB=1

# Queue Concurrency Settings (how many jobs processed simultaneously per queue)
QUEUE_NOTIFICATION_CONCURRENCY=5
QUEUE_DOCUMENT_CONCURRENCY=3
QUEUE_SYNC_CONCURRENCY=2
QUEUE_ANALYTICS_CONCURRENCY=1
QUEUE_CLEANUP_CONCURRENCY=1

# Job Retention (in days)
QUEUE_COMPLETED_RETENTION=7
QUEUE_FAILED_RETENTION=30

# Rate Limiting (jobs per minute)
QUEUE_RATE_LIMIT_MAX=100
QUEUE_RATE_LIMIT_DURATION=60000

# Retry Strategy
QUEUE_MAX_RETRY_ATTEMPTS=3
QUEUE_RETRY_BACKOFF_TYPE=exponential
QUEUE_RETRY_BACKOFF_DELAY=2000

# Dead Letter Queue Threshold
QUEUE_DLQ_THRESHOLD=100

# Rate Limiting Configuration
# THROTTLE_TTL: Time window in milliseconds (default: 60000 = 1 minute)
# THROTTLE_LIMIT: Max requests per time window (default: 10)
THROTTLE_TTL=60000
THROTTLE_LIMIT=10

# AWS S3 File Upload Configuration
# âš ï¸  REQUIRED for file upload functionality
# Create IAM user with S3 permissions: s3:PutObject, s3:GetObject, s3:DeleteObject, s3:ListBucket
# Documentation: https://docs.aws.amazon.com/AmazonS3/latest/userguide/

# AWS Credentials
AWS_REGION=us-east-1
AWS_ACCESS_KEY_ID=your_aws_access_key_here
AWS_SECRET_ACCESS_KEY=your_aws_secret_key_here

# S3 Bucket Configuration
S3_BUCKET_NAME=your-bucket-name

# Presigned URL Expiration (in seconds)
# How long presigned URLs remain valid (default: 300 = 5 minutes)
S3_PRESIGNED_EXPIRES=300

# File Upload Limits
# Maximum file size in bytes (default: 10MB)
MAX_FILE_SIZE=10485760

# Allowed MIME types (comma-separated)
# Common types: application/pdf, image/jpeg, image/png, image/gif, image/webp
ALLOWED_MIME_TYPES=application/pdf,image/jpeg,image/png,image/gif,image/webp,application/msword,application/vnd.openxmlformats-officedocument.wordprocessingml.document

# ================================
# ğŸ” FIELD-LEVEL ENCRYPTION
# ================================
# Encrypts sensitive fields (healthHistory, allergies, SSN, etc.) before storing in MongoDB
# Even if database is breached, encrypted fields are unreadable
#
# Choose one strategy based on your needs:
#
# STRATEGY 1: DISABLED (Default)
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# Cost: FREE
# Security: âŒ None
# Use for: Non-sensitive data, public information
# Config: ENCRYPTION_STRATEGY=disabled
#
# STRATEGY 2: LOCAL (Free Alternative)
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# Cost: FREE
# Security: âœ… AES-256-GCM (same cipher as AWS KMS)
# Use for: Small projects, internal tools, budget constraints
# Limitations: Manual key rotation, no audit trail
#
# Setup:
# 1. Generate master key: node -e "console.log(require('crypto').randomBytes(32).toString('hex'))"
# 2. Set ENCRYPTION_STRATEGY=local
# 3. Set ENCRYPTION_MASTER_KEY=<generated-64-char-hex-key>
#
# STRATEGY 3: AWS_KMS (Enterprise-Grade) â­ RECOMMENDED FOR PRODUCTION
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# Cost: ~$7/month for 1 million records ($1/month key + $0.03 per 10K requests)
# Security: âœ…âœ…âœ… Bank-grade HSM, Automatic rotation, Audit logs
# Compliance: HIPAA, GDPR, PCI DSS certified
# Use for: Medical data, financial data, regulated industries
#
# Setup:
# 1. Create KMS key: https://console.aws.amazon.com/kms
# 2. Grant IAM permissions: kms:GenerateDataKey, kms:Decrypt
# 3. Enable automatic key rotation (recommended: every 90 days)
# 4. Set ENCRYPTION_STRATEGY=aws_kms
# 5. Set KMS_KEY_ID and AWS_REGION below
#
# âš ï¸  WARNING: Changing strategies after data is encrypted requires migration!
# âš ï¸  Keep old keys accessible for decryption even after rotation
#
# Choose your strategy:
ENCRYPTION_STRATEGY=disabled

# LOCAL Strategy Settings (only if ENCRYPTION_STRATEGY=local)
ENCRYPTION_MASTER_KEY=

# AWS KMS Strategy Settings (only if ENCRYPTION_STRATEGY=aws_kms)
KMS_KEY_ID=

